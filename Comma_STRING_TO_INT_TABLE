---STRING_TO_INT_TABLE
USE YOUR_DATABASE
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [dbo].[STRING_TO_INT_TABLE] (@LIST_STRING NVARCHAR(MAX)) -- COMMA Separated NUMERS
  RETURNS @VALUE_TABLE TABLE (NUMBER INT NOT NULL) AS
BEGIN
  DECLARE @POS INT, @NEXTPOS INT, @VALUELEN INT;
  
  SELECT @POS=0, @NEXTPOS=1;
  WHILE @NEXTPOS > 0
    BEGIN
      SELECT @NEXTPOS = CHARINDEX(',', @LIST_STRING, @POS + 1);
      SELECT @VALUELEN = CASE WHEN @NEXTPOS > 0 THEN @NEXTPOS ELSE LEN(@LIST_STRING) + 1 END - @POS - 1;
      INSERT INTO @VALUE_TABLE(NUMBER)
      VALUES (CONVERT(INT, SUBSTRING(@LIST_STRING, @POS + 1, @VALUELEN)));
     
      SELECT @POS = @NEXTPOS;
	END 
    RETURN;
END
